# –ê–Ω–∞–ª–∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤ LLM-–∞–≥–µ–Ω—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é TF-IDF, SVD –∏ –ª–∏–Ω–µ–π–Ω–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏

## üìò –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è **–∞–Ω–∞–ª–∏–∑–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ –º–µ–∂–¥—É –¥–≤—É–º—è LLM-–∞–≥–µ–Ω—Ç–∞–º–∏** ‚Äî `analytic` –∏ `finance`, —Ä–∞–±–æ—Ç–∞—é—â–∏–º–∏ —á–µ—Ä–µ–∑ API **GigaChat**.  
–¶–µ–ª—å ‚Äî –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ—Å—Ç—É—é –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è —É—á–∏—Ç—Å—è **–ø–æ —Ç–µ–∫—Å—Ç–∞–º —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å —á–∏—Å–ª–µ–Ω–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏** (score), —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—é—â–∏–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏–ª–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å —Ä–µ–ø–ª–∏–∫.

–í –æ—Å–Ω–æ–≤–µ –ª–µ–∂–∏—Ç —Å–ª–µ–¥—É—é—â–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤:
1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤.
2. –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é **TF-IDF**.
3. –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ —Å –ø–æ–º–æ—â—å—é **Truncated SVD**.
4. –û–±—É—á–µ–Ω–∏–µ –ª–∏–Ω–µ–π–Ω–æ–π –º–æ–¥–µ–ª–∏ (**Linear Regression**).
5. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –æ—Ü–µ–Ω–æ–∫ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

---

## üß© –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
project/
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ dialogue/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ history.py        # –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ —á—Ç–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ llm/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ agent.py          # –ö–ª–∞—Å—Å Agent –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å GigaChat
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prompts.py        # –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤ (analytic, finance)
‚îÇ   ‚îú‚îÄ‚îÄ utils.py              # –£—Ç–∏–ª–∏—Ç—ã (–ø–∞–π–ø–ª–∞–π–Ω, —Ñ–∏–ª—å—Ç—Ä—ã, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è)
‚îÇ
‚îú‚îÄ‚îÄ train_history.json        # –ò—Å—Ç–æ—Ä–∏—è –æ–±—É—á–µ–Ω–∏—è (–µ—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞)
‚îú‚îÄ‚îÄ test_history_v2.json      # –¢–µ—Å—Ç–æ–≤–∞—è –∏—Å—Ç–æ—Ä–∏—è
‚îú‚îÄ‚îÄ result.json               # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ .env                      # –¢–æ–∫–µ–Ω –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã GigaChat
‚îî‚îÄ‚îÄ main.py                   # –û—Å–Ω–æ–≤–Ω–æ–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Å–∫—Ä–∏–ø—Ç (—Ç–æ—Ç, —á—Ç–æ –ø—Ä–∏–≤–µ–¥—ë–Ω –≤—ã—à–µ)
```

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install -r requirements.txt
```

–∏–ª–∏ –≤—Ä—É—á–Ω—É—é:

```bash
pip install python-dotenv langchain_gigachat scikit-learn
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.env`

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```
GIGACHAT_API_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω
GIGACHAT_MODEL=gpt
GIGACHAT_SCOPE=GIGACHAT_API_PERS
```

### 3. –ó–∞–ø—É—Å–∫

```bash
python main.py
```

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –∫–æ—Ä–Ω–µ –ø–æ—è–≤–∏—Ç—Å—è —Ñ–∞–π–ª `result.json` —Å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è–º–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –∞–≥–µ–Ω—Ç—É.

---

## üß† –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

### 1. –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤ (TF-IDF)

–ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ –≤–µ–∫—Ç–æ—Ä, –≥–¥–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏ —Å–ª–æ–≤ –∏ –±–∏–≥—Ä–∞–º–º:

$$
\text{TF-IDF}(t, d) = \text{TF}(t, d) \times \log \frac{N}{\text{DF}(t)}
$$

–≥–¥–µ:

* $\text{TF}(t, d)$ ‚Äî —á–∞—Å—Ç–æ—Ç–∞ —Ç–µ—Ä–º–∏–Ω–∞ $t$ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ $d$,
* $\text{DF}(t)$ ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö —Ç–µ—Ä–º–∏–Ω $t$,
* $N$ ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

---

### 2. –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ (Truncated SVD)

TF-IDF –≤–µ–∫—Ç–æ—Ä—ã —á–∞—Å—Ç–æ –∏–º–µ—é—Ç **—Ç—ã—Å—è—á–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤**, —á—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å –∏ —à—É–º.  
–î–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Truncated SVD (Singular Value Decomposition)**:

$$
X \approx U_k \Sigma_k V_k^T
$$

–≥–¥–µ:

* $X$ ‚Äî –º–∞—Ç—Ä–∏—Ü–∞ TF-IDF,  
* $U_k$, $\Sigma_k$, $V_k^T$ ‚Äî —É—Å–µ—á—ë–Ω–Ω—ã–µ –º–∞—Ç—Ä–∏—Ü—ã —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ $k$,  
* $k$ ‚Äî —á–∏—Å–ª–æ –≥–ª–∞–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (`N_COMPONENTS`).

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

* —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å 5000 –¥–æ 100),
* —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –º—É–ª—å—Ç–∏–∫–æ–ª–ª–∏–Ω–µ–∞—Ä–Ω–æ—Å—Ç—å,
* —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥–ª–∞–≤–Ω—ã–µ —Å–º—ã—Å–ª–æ–≤—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –¥–∞–Ω–Ω—ã—Ö.

–§–∞–∫—Ç–∏—á–µ—Å–∫–∏ SVD –∏–≥—Ä–∞–µ—Ç —Ä–æ–ª—å **–∞–Ω–∞–ª–æ–≥–∞ PCA –¥–ª—è —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω—ã—Ö –º–∞—Ç—Ä–∏—Ü TF-IDF**.

---

### 3. –õ–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è

–ü–æ—Å–ª–µ —Å–Ω–∏–∂–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –æ–±—É—á–∞–µ—Ç—Å—è –º–æ–¥–µ–ª—å:

$$
\hat{y} = XW + b
$$

–≥–¥–µ:

* $X$ ‚Äî –º–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ SVD,  
* $W$, $b$ ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏,  
* $\hat{y}$ ‚Äî –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞.

–ú–æ–¥–µ–ª—å –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç —Å—Ä–µ–¥–Ω–µ–∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω—É—é –æ—à–∏–±–∫—É (MSE):

$$
\min_{W, b} \| XW + b - y \|^2
$$

---

## üßÆ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞

### –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ (`pipeline_by_get_model`)

1. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ç–µ–∫—Å—Ç—ã –≤ TF-IDF –º–∞—Ç—Ä–∏—Ü—É.  
2. –ü—Ä–∏–º–µ–Ω—è–µ—Ç SVD –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏.  
3. –û–±—É—á–∞–µ—Ç `LinearRegression` –Ω–∞ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –º–∞—Ç—Ä–∏—Ü–µ–π –∏ –æ—Ü–µ–Ω–∫–∞–º–∏.

### –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ (`pipeline_by_predict`)

1. –û—Ç–±–∏—Ä–∞–µ—Ç —Ç–µ–∫—Å—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∞.  
2. –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ç–µ –∂–µ TF-IDF –∏ SVD —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏.  
3. –î–µ–ª–∞–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏.

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ñ–∞–π–ª `result.json`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Å–ª–æ–≤–∞—Ä–∏ –≤–∏–¥–∞:

```json
{
  "analytic": {
    "matrix": [[...], [...], ...],
    "predict": [0.12, 0.08, 0.15, ...]
  },
  "finance": {
    "matrix": [[...], [...], ...],
    "predict": [0.10, 0.09, 0.13, ...]
  }
}
```

---

## üß± –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä            | –û–ø–∏—Å–∞–Ω–∏–µ                        | –ó–Ω–∞—á–µ–Ω–∏–µ    |
| ------------------- | ------------------------------- | ----------- |
| `NGRAM_RANGE`       | –î–∏–∞–ø–∞–∑–æ–Ω n-–≥—Ä–∞–º–º –¥–ª—è TF-IDF     | (1, 2)      |
| `MAX_FEATURES`      | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤    | 5000        |
| `STOP_WORDS`        | –°–ø–∏—Å–æ–∫ —Å—Ç–æ–ø-—Å–ª–æ–≤                | ["russian"] |
| `N_COMPONENTS`      | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç SVD        | 100         |
| `RANDOM_STATE`      | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–µ—Ä–Ω–æ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ | 42          |
| `SIZE_FOR_GENERATE` | –†–∞–∑–º–µ—Ä —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏  | 100         |

---

## üìñ –ü—Ä–∏–º–µ—Ä –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã

```python
train_history, test_history = make_history()
model_analytic = make_predict()(train_history, "analytic")
predict_analytic = model_analytic(test_history)
```

–†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî —á–∏—Å–ª–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è, –∑–∞–≤–∏—Å—è—â–∏–µ –æ—Ç —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π.

---

## üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

* **Python 3.10+**
* **LangChain GigaChat** ‚Äî –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å LLM  
* **scikit-learn** ‚Äî –¥–ª—è TF-IDF, SVD –∏ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏  
* **dotenv** ‚Äî –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞–º–∏ API  
* **JSON** ‚Äî –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

---
